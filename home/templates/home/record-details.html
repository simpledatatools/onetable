<div class="row mb-5">
    <div class="col-xl-12">
        <!-- Account details card-->
        <div class="card card-header-actions">
            <div class="card-header bg-white">
                <div id="record-title-{{record.id}}">{{ record.primary_field.value }}</div>
                <div class="dropdown no-caret">
                    <button class="btn btn-transparent-dark btn-icon dropdown-toggle" id="dropdownMenuButton" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-bars"></i></button>
                    <div class="dropdown-menu dropdown-menu-right animated--fade-in-up" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="{% url 'edit_record' organization_pk=organization.pk app_pk=app.pk list_pk=list.pk record_pk=record.pk %}">
                            <div class="dropdown-item-icon"><i class="text-gray-500" data-feather="list"></i></div>
                            Edit Record
                        </a>
                        <button
                            data-toggle="modal"
                            data-target="#archive_record_detail_{{record.id}}"
                            class="dropdown-item"
                            href="{% url 'archive_record' organization_pk=organization.pk app_pk=app.pk list_pk=list.pk record_pk=record.pk %}"
                        >
                            <div class="dropdown-item-icon"><i class="text-gray-500" data-feather="list"></i></div>
                            Archive Record
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="archive_record_detail_{{record.id}}" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to Archive {{record.list}}?</h5>
                            <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                        </div>
                        <div class="modal-footer">
                            <span
                                class="btn btn-primary archive-record"
                                data-record-detail-id="{{record.pk}}"
                                type="button"
                                data-dismiss="modal"
                                href="{% url 'archive_record' organization_pk=organization.pk app_pk=app.pk list_pk=list.pk record_pk=record.pk %}"
                                data-content-id="{{file.id}}"
                            >
                                Archive
                            </span>
                            <span class="btn btn-light" type="button" data-dismiss="modal">No</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                {% if record.record_fields %} {% for field in record.record_fields %} {% if field.list_field.primary is False %} {% if field.list_field.field_type == "choose-from-list" %}
                <p>
                    <b>{{ field.list_field.field_label }}:</b>
                    {% if field.selected_record.status == 'active' %}
                    <a href="{% url 'record' organization_pk=organization.pk app_pk=app.pk list_pk=list.pk record_pk=field.selected_record.pk %}">
                        <span class="badge badge-primary p-2">{{ field.selected_record.primary_field.value }} </span>
                    </a>
                    {% endif %}
                </p>
                {% elif field.list_field.field_type == "url" %}
                <p><b>{{ field.list_field.field_label }}:</b> <a href="{{ field.value }}" target="_blank">{{ field.value }}</a></p>
                {% else %}
                <p><b>{{ field.list_field.field_label }}:</b> {{ field.value|safe }}</p>
                {% endif %} {% endif %} {% endfor %} {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="p-5 container">
    <div class="mb-3 row no-gutters">
        <div class="col-6">
            <h5>Files and Uploads</h5>
        </div>
        <div class="col-6">
            <div id="postRecordFile" class="btn btn-primary float-right" action="{% url 'post_record_file' organization.pk app.pk list.pk record.pk %}">
                Add File
            </div>
        </div>
    </div>
    <hr />
    <div id="fileprogress"></div>
    <div id="fileslist" class="row">
        <div id="template-preview" class="d-none"></div>

        {% for file in files %}
        <div id="file-{{file.pk}}" class="col-6">
            <div class="text-center m-3 card">
                <div class="row card-body">
                    <div style="font-size:0px"   class="col-10 card-text text-left">
                        <span class="d-inline content">
                            <span style="font-size:16px"  class="d-inline name-of-file">{{file.name_of_file}}</span>
                        </span>
                        <span style="font-size:16px"  class="d-inline file-extension">{{file.file_extension}}</span>
                        <div style="display:none"  class="mt-3 error_message text-danger">
                        <ul style="font-size:16px;">
                            <li>The file name must not be empty</li>
                            <li>The file name must not contain any spaces</li>
                        </ul>
                        </div>
                    </div>
                    <div class="col-2"><a href="{{file.edit_url}}" data-file-id="{{file.pk}}" class="edit-file btn btn-link">Edit</a></div>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-file-{{file.id}}">Remove</button><a class="btn btn-link float-right" href="{{file.url}}">Download</a>
                </div>
            </div>
        </div>
        <div class="modal fade" id="remove-file-{{file.id}}" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove {{file.filename}}?</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-footer">
                        <span class="btn btn-danger remove-record-file" type="button" data-dismiss="modal" href="{{file.delete_url}}" data-content-id="{{file.id}}">Confirm</span>
                        <span class="btn btn-light" type="button" data-dismiss="modal">No</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div class="p-5 container">
    <div class="mb-3 row no-gutters">
        <div class="col-6">
            <h5>Images and Videos</h5>
        </div>
        <div class="col-6">
            <div id="postRecordMedia" class="btn btn-primary float-right" action="{% url 'post_record_media' organization.pk app.pk list.pk record.pk %}">
                Add File
            </div>
        </div>
    </div>
    <hr />
    <div id="mediaprogress"></div>
    <div id="medialist" class="row">
        <div id="template-preview" class="d-none"></div>

        {% for file in media %}
        <div id="media-{{file.pk}}" class="col-3 h-100">
            <div class="text-center m-3 card">
                <div class="card-body">
                    <p class="card-text text-left">
                        {% if file.type == 'V' %}
                        <center><img src="{{file.image_thumbnail.url}}" class="img-fluid" /></center>
                        {% else %}
                        <center><img src="{{file.url}}" class="img-fluid" /></center>
                        {% endif %}
                    </p>

                    <p></p>
                </div>

                <div class="card-footer bg-white">
                    <button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-media-{{file.pk}}">Remove</button><a class="btn btn-link float-right" href="{{file.url}}">Download</a>
                </div>
            </div>
        </div>
        <div class="modal fade" id="remove-media-{{file.pk}}" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove this?</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <center>
                        <div class="modal-body">
                            {% if file.type == 'V' %}
                            <center><img src="{{file.image_thumbnail.url}}" class="img-fluid" /></center>
                            {% else %}
                            <center><img src="{{file.url}}" class="img-fluid" /></center>
                            {% endif %}
                        </div>
                    </center>
                    <div class="modal-footer">
                        <span class="btn btn-danger remove-record-media" type="button" data-dismiss="modal" href="{{file.delete_url}}" data-content-id="{{file.id}}">Confirm</span>
                        <span class="btn btn-light" type="button" data-dismiss="modal">No</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div class="p-5 container">
    <h5>Comments</h5>
    <hr />
    <div class="card p-3">
        <form id="post_record_comment" method="POST" action="{% url 'post_record_comments' organization.pk app.pk list.pk record.pk %}">
            <textarea id="content" class="form-control bg-light mb-3" name="content" type="text" placeholder="Enter a comment here"></textarea><br />
            <div class="text-right"><input class="btn btn-primary" id="post_record_button" type="submit" /></div>
        </form>
    </div>
    <div class="d-block" id="record_comments">
        {% for comment in comments %}
        <form data-comment-id="{{comment.pk}}" class="edit_comment_form" action="{% url 'edit_record_comment' organization.pk app.pk list.pk record.pk comment.pk %}" method="POST">
            <div class="card m-3" id="comment-{{comment.pk}}" class="card text-center m-3">
                <div class="card-body">
                    <div class="main-change">
                        <div id="comment-content-{{comment.pk}}"class="card-text text-left content">
                            {% autoescape off %} {{comment.content}} {% endautoescape %}
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-comment-{{comment.pk}}">Remove</button>
                    <span id="edit-save-{{comment.pk}}">
                        <input type="button" data-comment-id="{{comment.pk}}" href="{{comment.edit_url}}" class="btn btn-link float-right edit-comment edit" value="Edit" />

                        <input type="submit" data-comment-id="{{comment.pk}}" class="btn btn-link float-right save" style="display: none;" value="Save" />
                    </span>
                </div>
            </div>
        </form>
        <div class="modal fade" id="remove-comment-{{comment.pk}}" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove the comment?</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-body">{% autoescape off %}{{comment.content}}{% endautoescape %}</div>
                    <div class="modal-footer">
                        <span class="btn btn-danger remove-record-comment" type="button" data-dismiss="modal" href="{{comment.delete_url}}" data-content-id="{{comment.id}}">Confirm</span>
                        <span class="btn btn-light" type="button" data-dismiss="modal">No</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function hasWhiteSpace(value) {
    return value.indexOf(' ') >= 0;
}
var record_files = $('#fileslist');
var record_media = $('#medialist');

function EditFile() {
    var file_edit_mode = false;
    var file_current_edit = null;
    $('.edit-file').on('click', function(ev) {
            ev.preventDefault();
            var file_id = $(this).attr('data-file-id');
            var content_box = $('#file-' + file_id + ' .content');
            var name = $('#file-' + file_id + ' .name-of-file').text();
            if (file_edit_mode == false) {
                if (file_current_edit == null) {
                    $(this).html('Save');
                    $('#file-' + file_id + ' .file-extension').addClass('d-none');
                    $('#file-' + file_id + ' .file-extension').removeClass('d-inline');
                    content_box.html('<input type="text" id="file-edit-' + file_id + '" value="' + name + '" class="bg-light text-dark form-control w-100"/>');
                    file_edit_mode = true;

                    console.log('#file-' + file_id + ' .file-extension');
                    file_current_edit = $(this).attr('data-file-id');
                }
            } else {
                this_file = $(this).attr('data-file-id');
                var new_name = $('#file-edit-' + file_id).val();
                if (this_file == file_current_edit) {
                    console.log(new_name!='');
                    console.log(!hasWhiteSpace(new_name));
                    if(new_name != '' && !hasWhiteSpace(new_name)){
                    edit_url = $(this).attr('href');
                    file_edit_mode = false;
                    file_current_edit = null;
                    $(this).html('Edit');
                    $.post(edit_url, {
                        "content": $('#file-edit-' + file_id).val()
                    }, function(data) {
                        content_box.html('<span class="d-inline name-of-file" style="font-size:16px">'+data['content']+'</span>');
                        $('#file-' + file_id + ' .file-extension').removeClass('d-none');
                        $('#file-' + file_id + ' .file-extension').addClass('d-inline');
                         $('#file-' + file_id + ' .error_message').hide();
                    });
                }
                else{
                    $('#file-' + file_id + ' .error_message').show();
                }
              }
            }

        }

    );
}

function getCookie(c_name) {
    var c_value = " " + document.cookie;
    var c_start = c_value.indexOf(" " + c_name + "=");
    if (c_start == -1) {
        c_value = null;
    } else {
        c_start = c_value.indexOf("=", c_start) + 1;
        var c_end = c_value.indexOf(";", c_start);
        if (c_end == -1) {
            c_end = c_value.length;
        }
        c_value = unescape(c_value.substring(c_start, c_end));
    }
    return c_value;
}

Dropzone.autoDiscover = false;

var cookie = document.cookie;
var csrftoken = getCookie('csrftoken');
var post_file_url = $('#postRecordFile').attr('action');
var post_media_url = $('#postRecordMedia').attr('action');
$(function() {
    var myDrop = new Dropzone("div#postRecordFile", {
        url: post_file_url,
        method: "post",
        headers: {
            "csrfmiddlewaretoken": csrftoken
        },
        previewsContainer: null,
        previewTemplate: document.getElementById('fileslist').innerHTML
    });

    myDrop.on("success", function(file, data) {
        data = JSON.parse(data);
        console.log(data);
        var file_div = ' <div id="file-' + data.id + '" class="col-6"> <div class="text-center m-3 card"> <div class="row card-body"> <div class="col-10 card-text text-left"> <span class="d-inline content"> <span class="d-inline name-of-file">' + data.file_name + '</span> </span> <span class="d-inline file-extension">' + data.file_extension + '</span><div style="display:none" class="mt-3 error_message text-danger"><ul><li>The file name must not be empty</li><li>The file name must not contain any spaces</li></ul></div> </div> <div class="col-2"><a href="' + data.edit_url + '" data-file-id="' + data.id + '" class="edit-file btn btn-link">Edit</a></div> </div> <div class="card-footer bg-white"><button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-file-' + data.id + '" >Remove</button><a class="btn btn-link float-right" href="' + data.file_url + '">Download</a></div> </div> </div> <div class="modal fade" id="remove-file-' + data.id + '" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered" role="document"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove ' + data.file_name + '?</h5> <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button> </div> <div class="modal-footer"><span class="btn btn-danger remove-record-file" type="button" data-dismiss="modal" href="' + data.delete_url + '" data-content-id="' + data.id + '">Confirm</span><span class="btn btn-light" type="button" data-dismiss="modal">No</span></div> </div> </div> </div>';
        record_files.prepend(file_div);
        RemoveContent('.remove-record-file', 'file');
        var progress_bar = '<div style="height:30px;font-size:22px;height:40px" class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">' + "uploaded successfully!" + '</div></div>';
        $('#fileprogress').html(progress_bar);
        EditFile();
    });

    myDrop.on("totaluploadprogress", function(progress) {
        console.log(file, progress, bytesSent);
        var progress_bar = '<div style="height:30px;font-size:22px;height:40px" class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: ' + progress + '%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">' + parseInt(progress) + '%</div></div>';
        $('#fileprogress').html(progress_bar);
    });

    myDrop.on("queuecomplete", function(file) {
        var progress_bar = '<div style="height:30px;font-size:22px;height:40px" class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">' + "uploaded successfully!" + '</div></div>';
        $('#fileprogress').html(progress_bar);
        setTimeout(function() {
            $('#fileprogress').html('');
        }, 5000);
    });

});


function RemoveContent(className, content) {
    $(className).on('click', function(ev) {
        ev.preventDefault();
        var url = $(this).attr('href');
        var content_id = $(this).attr('data-content-id');
        $.get(url, function(data) {
            console.log(content);
            console.log('#' + content + '-' + content_id);
            var content_box = $('#' + content + '-' + content_id);
            console.log(content_box);
            content_box.remove();
        });
    });
}



$(function() {
    var myDrop = new Dropzone("div#postRecordMedia", {
        url: post_media_url,
        method: "post",
        headers: {
            "csrfmiddlewaretoken": csrftoken
        },
        previewsContainer: null,
        previewTemplate: document.getElementById('medialist').innerHTML
    });

    myDrop.on("success", function(file, data) {
        data = JSON.parse(data);
        console.log(data);
        var media_div = ' <div id="media-' + data.id + '" class="col-3 h-100"> <div class="text-center m-3 card"> <div class="card-body"> <p class="card-text text-center"> <img src="' + data.file_url + '" class="img-fluid"/> </p> </div> <div class="card-footer bg-white"><button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-media-' + data.id + '">Remove</button><a class="btn btn-link float-right" href="' + data.url + '">Download</a></div> </div> </div> <div class="modal fade" id="remove-media-' + data.id + '" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered" role="document"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove this?</h5> <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button> </div> <div class="modal-body"><center><img src="' + data.file_url + '" class="img-fluid"/></center></div> <div class="modal-footer"><span class="btn btn-danger remove-record-media" type="button" data-dismiss="modal" href="' + data.file_url + '" data-content-id="' + data.id + '">Confirm</span><span class="btn btn-light" type="button" data-dismiss="modal">No</span></div> </div> </div></div>';
        record_media.prepend(media_div);
        RemoveContent('.remove-record-media', 'media');

    });

    myDrop.on("totaluploadprogress", function(progress) {
        console.log(progress);
        var progress_bar = '<div style="font-size:22px;height:40px" class="progress p-1"><div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: ' + progress + '%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">' + parseInt(progress) + '%</div></div>';
        $('#mediaprogress').html(progress_bar);
    });

    myDrop.on("queuecomplete", function(file) {
        var progress_bar = '<div style="font-size:22px;height:40px" class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">' + "uploaded successfully!" + '</div></div>';
        $('#mediaprogress').html(progress_bar);
        setTimeout(function() {
            $('#mediaprogress').html('');
        }, 5000);
    });

});


$(document).ready(function() {

    $(function() {
        var frm = $('#post_record_comment');
        frm.value = '';
        var record_comments = $('#record_comments');

        frm.submit(function(ev) {
            ev.preventDefault();
            console.log(frm.serialize('content'));

            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }


            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            })


            tinyMCE.triggerSave();
            $.ajax({

                type: frm.attr('method'),
                url: frm.attr('action'),
                data: frm.serialize(),
                headers: {
                    'X-CSRFToken': csrftoken
                },
                success: function(data) {
                    var content = $('#content').val();
                    $('#content').val('');
                    console.log(data);
                    data = JSON.parse(data);
                    var comment_div = `<form data-comment-id="${data.id}" class="edit_comment_form" action="${data.edit_url}" method="POST">
                    <div class="card m-3" id="comment-${data.id}" class="card text-center m-3">
                      <div class="card-body">
                        <div class="main-change">
                          <div id="comment-content-${data.id}" class="card-text text-left content">
                            ${data.content}
                          </div>
                        </div>
                      </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-link float-right" type="button" data-toggle="modal" data-target="#remove-comment-${data.id}">Remove</button>
                    <span id="edit-save-${data.id}">
                        <input type="button" data-comment-id="${data.id}" href="${data.edit_url}" class="btn btn-link float-right edit-comment edit" value="Edit" />
                        <input type="submit" data-comment-id="${data.id}" class="btn btn-link float-right save" style="display: none;" value="Save" />
                    </span>
                </div>
            </div>
        </form>
        <div class="modal fade" id="remove-comment-'+data.id+'" tabindex="-1" role="dialog" aria-labelledby="Remove-comment" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Are you sure that you want to remove the comment?</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-body">'+data.content+'</div>
                    <div class="modal-footer">
                        <span class="btn btn-danger remove-record-comment" type="button" data-dismiss="modal" href="${data.edit_url}" data-content-id="${data.id}">Confirm</span>
                        <span class="btn btn-light" type="button" data-dismiss="modal">No</span>
                    </div>
                </div>
            </div>
        </div>`;
                    record_comments.prepend(comment_div);
                    EditPost();
                    RemoveContent('.remove-record-comment', 'comment');
                }
            });
            ev.preventDefault();
        });
    });



    function EditPost() {

        var current_edit = null;
        $('.edit-comment').on('click', function(ev) {
                ev.preventDefault();

                if (current_edit == null) {
                    var comment_id = $(this).attr('data-comment-id');

                    var content = $('#comment-' + comment_id + ' .content');
                    var content_message = content.text()
                    var edit_mode = false;
                    frm = $('.edit_comment_form');
                    if (edit_mode == false) {

                        edit_mode = true;



                        tinyMCE.init({
                            selector: '#comment-' + comment_id + ' .content',
                        });

                        $('#edit-save-' + comment_id + ' .edit').hide();
                        $('#edit-save-' + comment_id + ' .save').show();

                    }
                }

            }

        );


        $('.edit_comment_form').on('submit', function(ev) {
                ev.preventDefault();
                tinyMCE.triggerSave();
                var comment_id = $(this).attr('data-comment-id');
                console.log(frm.serialize());

                $.ajax({

                    type: $(this).attr('method'),
                    url: $(this).attr('action'),
                    data: $(this).serialize(),
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    success: function(data) {
                        $('#comment-' + comment_id + ' .main-change').html(data.content);
                        $('#edit-save-' + comment_id + ' .edit').show();
                        $('#edit-save-' + comment_id + ' .save').hide();
                        edit_mode = false;
                        current_edit = null;
                    }
                });



            }



        );
    }

    EditPost();



    EditFile();

    function ArchiveRecord() {
        $('.archive-record').on('click', function(ev) {
            ev.preventDefault();
            var archive_url = $(this).attr('href');
            var record_id = $(this).attr('data-record-detail-id');
            $.get(archive_url, function(data) {
                console.log(data);
                var record = $('#record-title-' + record_id);
                record.append('<span class="text-muted"> (Archived) </span>')
            });
        });
    }
    ArchiveRecord();

    RemoveContent('.remove-record-file', 'file');
    RemoveContent('.remove-record-media', 'media');
    RemoveContent('.remove-record-comment', 'comment');




    if (window.tinymce) {
        $(window.tinymce.editors).each(function(idx, p) {
            window.tinymce.remove(idx);
        });
    }

    tinyMCE.init({
        selector: "#post_record_comment #content",
    });



});
</script>